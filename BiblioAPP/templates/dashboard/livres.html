{% load compress %}
{% load static %}
<!--reservation -->
<div class="flex flex-wrap -mx-3 mb-5">
    <div class="w-full max-w-full px-3 mb-6  mx-auto">
      <div class="relative flex-[1_auto] flex flex-col break-words min-w-0 bg-clip-border rounded-[.95rem] bg-white m-5">
        <div class="relative flex flex-col min-w-0 break-words border border-dashed bg-clip-border rounded-2xl border-stone-200 bg-light/30">
          <h1 class="text-xl text-bold mg-16 text-orange-400 bg-gray-100 w-fit px-4 py-2 rounded-lg">Livres</h1>
          <!-- FORM TO ADD NEW LIVRES form est provisoire -->
          <!-- component -->
          <div class="flex flex-col space-y-4">
            <form action="{% url 'addlivre' %}" method="post">
              {% csrf_token %}
              <div class="p-2">
                <label for="titre" class="text-gray-600">Titre</label>
                <input type="text" name="titre" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2">
                <label for="description" class="text-gray-600">Description</label>
                <textarea name="description" cols="30" rows="4"
                  class="w-full rounded-md border border-gray-300 shadow-sm"></textarea>
              </div>
              <div class="p-2">
                <label for="auteur" class="text-gray-600">Auteur</label>
                <input type="text" name="auteur" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2">
                <label for="genre" class="text-gray-600">Genre</label>
                <input type="text" name="genre" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2">
                <label for="langue" class="text-gray-600">Langue</label>
                <input type="text" name="langue" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2">
                <label for="quantite" class="text-gray-600">Quantité</label>
                <input type="number" name="quantite" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2">
                <label for="image" class="text-gray-600">Image Couverture</label>
                <input type="file" name="image" class="w-full rounded-md border border-gray-300 shadow-sm">
              </div>
              <div class="p-2 ">
                <button
                type="submit"
                class="p-2 bg-green-600 rounded-sm font-semibold"
                >
                Submit
              </button>
            </div>
              
            </form>
          </div>

          <!-- card body  -->
          <div class="flex-auto block py-8 pt-6 px-9">
            <div class="overflow-x-auto">
              <table class="w-full my-0 align-middle text-dark border-neutral-200 rounded-lg">
                    <thead class="align-bottom rounded-lg">
                      <tr class="text-md font-semibold tracking-wide text-left text-gray-900 bg-gray-100 uppercase border-b border-gray-600">
                        <th class="px-4 py-3 text-start ">titre</th>
                        <th class="px-4 py-3 text-start ">quantite</th>
                        <th class="px-4 py-3 text-start ">langue</th>
                        <th class="px-4 py-3 text-start ">genre</th>
                        <th class="px-4 py-3 text-start ">Etat</th>
                        <th class="px-4 py-3 text-start ">Edit</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for item in Livres %}
                        <tr class="border-b border-dashed last:border-b-0">
                            <td class="px-4 py-3 border">{{item.titre}}</td>
                            <td class="px-4 py-3 border">{{item.quantite}}</td>
                            <td class="px-4 py-3 border">{{item.langue}}</td>
                            <td class="px-4 py-3 border">{{item.genre}}</td>
                            <td class="px-4 py-3 border">
                                {% if not item.horspret %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#138808" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-check"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="m9 9.5 2 2 4-4"/></svg>
                                {% else %}
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ff1111" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-x"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="m14.5 7-5 5"/><path d="m9.5 7 5 5"/></svg>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 border"><button id="myBtn"
                              class="book-emprunt"
                              onclick="openModal('{{item.id_livre}}','{{item.quantite}}','{{item.horspret}}')">Edit</button>
                            </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                </table>
            </div>
            <!--Modal-->
            <div id="myModal" class="modal hidden fixed inset-0 z-20 overflow-auto bg-white/5 backdrop-blur-sm">
              <div class="modal-content bg-white mx-auto my-6 p-6 border border-gray-400 w-4/5 md:w-1/2 lg:w-1/3 rounded-lg">
                <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div
                      class="mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10">
                      <svg class="h-6 w-6 text-yellow-300" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                        aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round"
                          d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                      <h3 class="text-base font-semibold leading-6 text-gray-900" id="modal-title">Edit</h3>
                      <div class="mt-2">
                        <!--Form to  Edit-->
                        <div class="w-full max-w-md mx-auto">
                          <form action="{% url 'editlivre' %}" method="post" class="bg-white rounded px-8 pt-6 pb-8 mb-4">
                            {% csrf_token %}
                            <input type="hidden" id="ID" name="idlivre" value="">
                            <div class="mb-4">
                              <label class="block text-gray-700 text-sm font-bold mb-2" for="quantite">
                                Quantité
                              </label>
                              <input
                                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                                name="quantite"  id="Equantite" type="number" placeholder="Entrez la quantité">
                            </div>
                            <div class="mb-6">
                              <label class="block text-gray-700 text-sm font-bold mb-2" for="horspret">
                                Hors-Prêt
                              </label>
                              <input class="mr-2 leading-tight" type="checkbox" name="horspret" id="Ehorspret" value="True">
                              
                            </div>
                            <div class="flex items-center justify-between">
                              <input
                                class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"
                                type="submit" value="Enregistrer">
                            </div>
                          </form>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <button type="button"
                  class=" close mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Cancel</button>
              </div>
              </div>
        </div>
    </div>
</div>
<script>
  // Get the modal
  var modal = document.getElementById("myModal");
  var btn = document.getElementById("myBtn");


  var span = document.getElementsByClassName("close")[0];


  function openModal(id,quantite,horspret) {
    modal.classList.remove("hidden");

    document.getElementById("ID").value = parseInt(id);
    document.getElementById("Equantite").value = parseInt(quantite)
    document.getElementById("Equantite").min= parseInt(quantite)
    if(horspret=="True")
    {
      document.getElementById("Ehorspret").checked = true
    }
    else
    {
      document.getElementById("Ehorspret").checked = false
    }
  };

  // Function to close the modal (add 'hidden', remove 'block')
  span.onclick = function () {
    modal.classList.remove("block");
    modal.classList.add("hidden");
  };

  // Function to close modal if clicking outside of it
  window.onclick = function (event) {
    if (event.target === modal) {
      modal.classList.remove("block");
      modal.classList.add("hidden");
    }
  };
</script>
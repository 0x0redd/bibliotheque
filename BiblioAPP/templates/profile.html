{% load compress %}
{% load static %}


<!DOCTYPE html>
<html>
  <head>
    
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <link rel="shortcut icon" href="./assets/img/favicon.ico" />
    <link rel="apple-touch-icon" sizes="76x76" href="./assets/img/apple-icon.png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Profile </title>
    <style>
      .bg-cover{
        background-image: url("https://images.unsplash.com/photo-1607193634806-5c28805731aa?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D") !important; 
        backdrop-filter: blur(5px) !important;
      }
    </style>
  </head>
  
  <body class="text-gray-800 antialiased">
    {% include 'header.html' %}
    <main class="profile-page">
      <section class="relative block" style="height: 500px;">
        <div
          class="absolute top-0 w-full h-full bg-center bg-cover"
          style='background-image: url("../../static/source/profile/bg.jpg");'
        >
          <span
            id="blackOverlay"
            class="w-full h-full absolute opacity-50 bg-black"
          ></span>
        </div>
        <div
          class="top-auto bottom-0 left-0 right-0 w-full absolute pointer-events-none overflow-hidden"
          style="height: 70px;"
        >
          <svg
            class="absolute bottom-0 overflow-hidden"
            xmlns="http://www.w3.org/2000/svg"
            preserveAspectRatio="none"
            version="1.1"
            viewBox="0 0 2560 100"
            x="0"
            y="0"
          >
            <polygon
              class="text-gray-300 fill-current"
              points="2560 0 2560 100 0 100"
            ></polygon>
          </svg>
        </div>
      </section>
      <section class="relative py-16 bg-gray-300">
        <div class="container mx-auto px-4">
          <div
            class="relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-xl rounded-lg -mt-64"
          >
            <div class="px-6">
              <div class="flex flex-wrap justify-center">
                <div class="w-full lg:w-4/12 px-4 lg:order-2 flex justify-center">
                  <div class="relative  ">
                    <!-- image profile -->
                    {% if user.is_staff %}
                    <img 
                      src="{% static 'source/profile/'|add:user.first_name|stringformat:'s.jpg' %}"
                      alt="User Image"
                      class="shadow-xl rounded-full h-auto align-middle border-none -m-16 -ml-20 lg:-ml-16"
                      style="max-width: 150px;"
                    >
                    {% else %}
                    <img 
                      src="{% static 'source/profile/default.jpg' %}"
                      alt="User Image"
                      class="shadow-xl rounded-full h-auto align-middle border-none -m-16 -ml-20 lg:-ml-16"
                      style="max-width: 150px;"
                    >
                    {% endif %}
                  </div>
                </div>
                <div class="w-full px-4 lg:w-4/12 lg:order-3 lg:text-right lg:self-center">
                  <div class="py-6 px-3 mt-32 sm:mt-0 flex gap-2 items-center float-right">
                    
                    {% if user.is_authenticated %}
                    <form action="{% url 'profile' %}" method="post">
                      {% csrf_token %}
                      <button
                        class="flex items-center gap-1 bg-green-500  hover:shadow-lg uppercase text-white font-bold shadow text-xs px-4 py-2 rounded outline-none focus:outline-none sm:mr-2 mb-1"
                        type="submit" style="transition: all 0.15s ease 0s;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
                        dashboard
                      </button>
                    </form>
                    <form action="{% url 'logout' %}" method="post">
                      {% csrf_token %}
                      <button
                        class="flex items-center gap-1 bg-red-500 uppercase text-white font-bold hover:shadow-lg shadow text-xs px-4 py-2 rounded outline-none focus:outline-none sm:mr-2 mb-1"
                        type="submit" style="transition: all 0.15s ease 0s;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                        Disconnect
                      </button>
                    </form>
                    {% endif %}
                  </div>
                </div>
                <div class="w-full lg:w-4/12 px-4 lg:order-1">
                {% if user.is_staff %}
                  <div class="flex justify-center py-4 lg:pt-4 pt-8">
                    <div class="mr-4 p-3 text-center">
                      <span class="text-xl font-bold block uppercase tracking-wide text-gray-700">{{ count }}</span>
                      <span class="text-md text-gray-500">Livres réservés</span>
                    </div>
                    <div class="mr-4 p-3 text-center">
                      <span
                        class="text-xl font-bold block uppercase tracking-wide text-gray-700"
                        >0</span
                      ><span class="text-md text-gray-500">Livres empruntés</span>
                    </div>
                    <div class="lg:mr-4 p-3 text-center">
                      <span
                        class="text-xl font-bold block uppercase tracking-wide text-gray-700"
                        >0</span
                      ><span class="text-md text-gray-500">Penalités</span>
                    </div>
                  </div> 
                {% else %}
                  <div class="flex justify-center py-4 lg:pt-4 pt-8">
                    <div class="mr-4 p-3 text-center">
                      <span class="text-xl font-bold block uppercase tracking-wide text-gray-700">{{ count }}</span>
                      <span class="text-md text-gray-500">Livres réservés</span>
                    </div>
                    <div class="mr-4 p-3 text-center">
                      <span
                        class="text-xl font-bold block uppercase tracking-wide text-gray-700"
                        >0</span
                      ><span class="text-md text-gray-500">Livres empruntés</span>
                    </div>
                    <div class="lg:mr-4 p-3 text-center">
                      <span
                        class="text-xl font-bold block uppercase tracking-wide text-gray-700"
                        >0</span
                      ><span class="text-md text-gray-500">Penalités</span>
                    </div>
                  </div> 
                {% endif %}
                </div> 
                
               
              </div>
              <div class="text-center">
                 <!--  name -->
                <h3 class="text-4xl font-semibold leading-normal mb-2 text-gray-800 "> {{ user.username }} </h3>
                <!--  name -->
                <div
                  class="text-sm leading-normal mt-0 mb-2 text-gray-500 font-semibold uppercase"
                >
                  <i
                    class="fas fa-map-marker-alt mr-2 text-lg text-gray-500"
                  ></i>
                  Meknes, Maroc
                </div>
                <div class="mb-2 font-semibold text-gray-500">
                  <i class="fas fa-briefcase mr-2 text-lg text-gray-500"></i
                  >
                  {% if user.is_staff %}
                    Administrateur
                  {%else%}
                    Etudiant
                  {%endif%}
                </div>
                <div class="mb-2 font-semibold text-gray-500">
                  <i class="fas fa-university mr-2 text-lg text-gray-500"></i
                  >Université Moulay Ismail
                </div>
              </div>
              <h1 class="font-bold text-3xl">Réservations</h1>
              <ul>
                <!-- Iterate over the 'reservation' context data -->
                <!-- component -->
                <section class="container mx-auto p-6 font-mono">
                  <div class="w-full mb-8 overflow-hidden rounded-lg shadow-lg">
                    <div class="w-full overflow-x-auto">
                      <table class="w-full">
                        <thead>
                          <tr
                            class="text-md font-semibold tracking-wide text-left text-gray-900 bg-gray-100 uppercase border-b border-gray-600">
                            <th class="px-4 py-3">Livres</th>
                            {% if user.is_staff %}
                            <th class="px-4 py-3">Etudiant</th>
                            {% endif %}
                            <th class="px-4 py-3">Date</th>
                            <th class="px-4 py-3">Status</th>
                            {% if user.is_staff %}
                            <th class="px-4 py-3">Confirmer</th>
                            {% endif %}
                            <th class="px-4 py-3">Annuler</th>
                          </tr>
                        </thead>
                        <tbody class="bg-white">
                          {% for res in reservation %}
                          <tr class="text-gray-700">
                            <td class="px-4 py-3 border">
                              <div class="flex items-center text-sm">
                                <div class="relative w-8 h-8 mr-3 rounded-full md:block">
                                  <img class="object-cover w-full h-full rounded-full"
                                    src="{{res.id_livre.image}}"
                                    alt="" loading="lazy" />
                                  <div class="absolute inset-0 rounded-full shadow-inner" aria-hidden="true"></div>
                                </div>
                                <div>
                                  <p class="font-semibold text-black">{{res.id_livre.titre}} </p>
                                </div>
                              </div>
                            </td>
                            {% if user.is_staff %}
                            <td class="px-4 py-3 text-ms font-semibold border">{{res.id_etudiant.username}}</td>
                            {% endif %}
                            <td class="px-4 py-3 text-ms font-semibold border">{{res.date_reservation}}</td>
                            <td class="px-4 py-3 text-xs border">
                              <span class="px-2 py-1 font-semibold leading-tight text-yellow-700 bg-yellow-100 rounded-sm"> En Cours de traitement
                              </span>
                            </td>
                            {% if user.is_staff %}
                            <form action="{% url 'annuler'%}" method="post">
                              {% csrf_token %}
                              <input type="hidden" name="reservation" value="{{res.id_reservation}}">
                              <td class="p-0 text-sm border bg-green-600 hover:bg-green-400 transition-all duration-200"><button class="font-bold py-4 px-4 w-full text-left text-white" type="submit" value="Confirmer">Confirmer</button></td>
                            </form>
                            {% endif %}
                            <form action="{% url 'annuler'%}" method="post">
                              {% csrf_token %}
                              <input type="hidden" name="reservation" value="{{res.id_reservation}}">
                              <td class="p-0 text-sm border bg-red-600 hover:bg-red-400 transition-all duration-200"><button class="font-bold py-4 px-4 w-full text-left text-white" type="submit" value="Annuler">Annuler</button></td>
                            </form>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>
              </ul>
              <h1 class="font-bold text-3xl"><h1 class="font-bold text-3xl">emprunt</h1>
              <ul>
                <!-- Iterate over the 'reservation' context data -->
                <!-- component -->
                <section class="container mx-auto p-6 font-mono">
                  <div class="w-full mb-8 overflow-hidden rounded-lg shadow-lg">
                    <div class="w-full overflow-x-auto">
                      <table class="w-full">
                        <thead>
                          <tr
                            class="text-md font-semibold tracking-wide text-left text-gray-900 bg-gray-100 uppercase border-b border-gray-600">
                            <th class="px-4 py-3">Livres</th>
                            <th class="px-4 py-3">Date d'emprunt</th>
                            <th class="px-4 py-3">Date de Retour</th>
                            <th class="px-4 py-3">Annuler</th>
                          </tr>
                        </thead>
                        <tbody class="bg-white">
                          {% for emp in emprunt %}
                          <tr class="text-gray-700">
                            <td class="px-4 py-3 border">
                              <div class="flex items-center text-sm">
                                <div class="relative w-8 h-8 mr-3 rounded-full md:block">
                                  <img class="object-cover w-full h-full rounded-full"
                                    src="{{emp.id_livre.image}}"
                                    alt="" loading="lazy" />
                                  <div class="absolute inset-0 rounded-full shadow-inner" aria-hidden="true"></div>
                                </div>
                                <div>
                                  <p class="font-semibold text-black">{{emp.date_emprunt}}</p>
                                </div>
                              </div>
                            </td>
                            <td class="px-4 py-3 text-ms font-semibold border">{{emp.date_retour_prevue}}</td>
                            <td class="px-4 py-3 text-xs border">
                              <span class="px-2 py-1 font-semibold leading-tight text-yellow-700 bg-yellow-100 rounded-sm"> En Cours de traitement
                              </span>
                            </td>
                              <td class="p-0 text-sm border {%if emp.date_retour_effectif > emp.date_retour_prevue %} bg-red-500{%else %}bg-green-500 {% endif %} ">{{emp.date_retour_effectif}}</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>
                </section>
              </ul></h1>
              <!-- <div class="mt-10 py-10 border-t border-gray-300 text-center">
                <div class="flex flex-wrap justify-center">
                  <div class="w-full lg:w-9/12 px-4">
                    <p class="mb-4 text-lg leading-relaxed text-gray-800">
                      An artist of considerable range, Jenna the name taken by
                      Melbourne-raised, Brooklyn-based Nick Murphy writes,
                      performs and records all of his own music, giving it a
                      warm, intimate feel with a solid groove structure. An
                      artist of considerable range.
                    </p>
                    <a href="#pablo" class="font-normal text-pink-500"
                      >Show more</a
                    >
                  </div>
                </div>
              </div> -->
            </div>
          </div>
        </div>
      </section>
    </main>
    <footer class="relative bg-gray-300 pt-8 pb-6">
      <div
        class="bottom-auto top-0 left-0 right-0 w-full absolute pointer-events-none overflow-hidden -mt-20"
        style="height: 80px;"
      >
        <svg
          class="absolute bottom-0 overflow-hidden"
          xmlns="http://www.w3.org/2000/svg"
          preserveAspectRatio="none"
          version="1.1"
          viewBox="0 0 2560 100"
          x="0"
          y="0"
        >
          <polygon
            class="text-gray-300 fill-current"
            points="2560 0 2560 100 0 100"
          ></polygon>
        </svg>
      </div>
      <div class="container mx-auto px-4">
        <div class="flex flex-wrap">
          <div class="w-full lg:w-6/12 px-4">
            <h4 class="text-3xl font-semibold">Let's keep in touch!</h4>
            <h5 class="text-lg mt-0 mb-2 text-gray-700">
              Find us on any of these platforms, we respond 1-2 business days.
            </h5>
            <div class="mt-6">
              <button
                class="bg-white text-blue-400 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2 p-3"
                type="button"
              >
                <i class="flex fab fa-twitter"></i></button
              ><button
                class="bg-white text-blue-600 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2 p-3"
                type="button"
              >
                <i class="flex fab fa-facebook-square"></i></button
              ><button
                class="bg-white text-pink-400 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2 p-3"
                type="button"
              >
                <i class="flex fab fa-dribbble"></i></button
              ><button
                class="bg-white text-gray-900 shadow-lg font-normal h-10 w-10 items-center justify-center align-center rounded-full outline-none focus:outline-none mr-2 p-3"
                type="button"
              >
                <i class="flex fab fa-github"></i>
              </button>
            </div>
          </div>
          <div class="w-full lg:w-6/12 px-4">
            <div class="flex flex-wrap items-top mb-6">
              <div class="w-full lg:w-4/12 px-4 ml-auto">
                <span
                  class="block uppercase text-gray-600 text-sm font-semibold mb-2"
                  >Useful Links</span
                >
                <ul class="list-unstyled">
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://www.creative-tim.com/presentation"
                      >About Us</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://blog.creative-tim.com"
                      >Blog</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://www.github.com/creativetimofficial"
                      >Github</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://www.creative-tim.com/bootstrap-themes/free"
                      >Free Products</a
                    >
                  </li>
                </ul>
              </div>
              <div class="w-full lg:w-4/12 px-4">
                <span
                  class="block uppercase text-gray-600 text-sm font-semibold mb-2"
                  >Other Resources</span
                >
                <ul class="list-unstyled">
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://github.com/creativetimofficial/argon-design-system/blob/master/LICENSE.md"
                      >MIT License</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://creative-tim.com/terms"
                      >Terms &amp; Conditions</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://creative-tim.com/privacy"
                      >Privacy Policy</a
                    >
                  </li>
                  <li>
                    <a
                      class="text-gray-700 hover:text-gray-900 font-semibold block pb-2 text-sm"
                      href="https://creative-tim.com/contact-us"
                      >Contact Us</a
                    >
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <hr class="my-6 border-gray-400" />
        <div
          class="flex flex-wrap items-center md:justify-between justify-center"
        >
          <div class="w-full md:w-4/12 px-4 mx-auto text-center">
            <div class="text-sm text-gray-600 font-semibold py-1">
              Copyright © 2019 Tailwind Starter Kit by
              <a
                href="https://www.creative-tim.com"
                class="text-gray-600 hover:text-gray-900"
                >Creative Tim</a
              >.
            </div>
          </div>
        </div>
      </div>
    </footer>
  </body>
  <script>
    function toggleNavbar(collapseID) {
      document.getElementById(collapseID).classList.toggle("hidden");
      document.getElementById(collapseID).classList.toggle("block");
    }
  </script>
</html>
